<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Online Word Counter and Text Case Converter (UPPERCASE, Title Case, lowercase)</title>
    <!-- GOOGLE SEARCH CONSOLE VERIFICATION TAG -->
    <meta name="google-site-verification" content="zfnG6OZTz07EIX-OHmPkyE7W_a-rQtgSlerQgeq7v0g" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        .stat-card {
            /* Applied responsive flex sizing here to neatly fit 5 cards */
            @apply bg-white p-4 rounded-xl shadow-lg transition duration-200 hover:shadow-xl border border-gray-100 text-center;
            flex-grow: 1; 
            min-width: calc(50% - 8px); /* 2 per row on small screens (50% - gap) */
        }
        @media (min-width: 768px) { /* md breakpoint */
            .stat-card {
                min-width: calc(33.333% - 11px); /* 3 per row on medium screens */
            }
        }
        @media (min-width: 1024px) { /* lg breakpoint - fitting 5 */
            .stat-card {
                min-width: calc(20% - 13px); /* 5 per row on large screens (20% - gap) */
            }
        }
        .btn-case {
            @apply w-full text-sm font-semibold py-3 px-4 rounded-lg transition duration-200 ease-in-out transform hover:scale-[1.02] active:scale-[0.98] focus:outline-none focus:ring-4 focus:ring-blue-300;
        }
        .btn-primary { @apply bg-blue-600 text-white hover:bg-blue-700; }
        .btn-secondary { @apply bg-gray-200 text-gray-800 hover:bg-gray-300; }
        .btn-danger { @apply bg-red-500 text-white hover:bg-red-600; }
        .word-list-container {
            max-height: 200px; /* Constrain height */
            overflow-y: auto; /* Allow scrolling */
            -webkit-overflow-scrolling: touch; /* Improved mobile scrolling */
        }
        /* Custom form-radio style for modern appearance */
        .form-radio {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border-radius: 50%;
            border: 2px solid theme('colors.gray.400');
            transition: all 0.2s ease;
            height: 16px; /* Added height/width for better styling */
            width: 16px;
        }
        .form-radio:checked {
            border-color: theme('colors.blue.600');
            background-color: theme('colors.blue.600');
            box-shadow: inset 0 0 0 4px theme('colors.white');
        }
    </style>
    <!-- Essential SEO Meta Tags for discoverability -->
    <meta name="description" content="Use the free online tool to instantly convert text to UPPERCASE, lowercase, Sentence Case, Title Case, and get real-time statistics on word count, character count, and line count for essays or reports.">
    <meta name="keywords" content="text converter, case converter, word counter, character counter, unique word count, uppercase to lowercase, title case online, sentence case tool, free online utility, reverse text, remove extra spaces">
    <!-- Main AdSense Loader Script: This must remain in the head. -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1234567890123456"
         crossorigin="anonymous"></script>
    <!-- REMOVED: The redundant (adsbygoogle || []).push({}); from the head to avoid ReferenceError. -->
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-gray-800 tracking-tight mb-2">Text Transformer & Analyzer</h1>
            <p class="text-xl text-gray-500">Instantly reformat text and get real-time statistics on words, characters, and lines.</p>
        </header>

        <!-- SEO Content Block (NEW: Added descriptive, keyword-rich content here) -->
        <div class="mb-8 p-4 bg-blue-50 rounded-xl border border-blue-100 text-gray-700">
            <p class="text-lg leading-relaxed">The **Text Transformer & Analyzer** is the ultimate free online utility for writers, students, and professionals. Get instant, accurate results with our powerful **word counter** and **character counter** (with or without spaces). Instantly convert your text to **Title Case**, UPPERCASE, or lowercase using our fast **case converter**. Beyond basic stats, leverage our **unique word count** feature to analyze density and improve vocabulary for essays and reports. Use the utility actions to remove extra spaces or reverse word order instantly.</p>
        </div>
        <!-- End SEO Content Block -->

        <!-- Statistics Panel (Now with 5 cards, using a responsive flex wrapper) -->
        <div class="flex flex-wrap gap-4 mb-8">
            <div class="stat-card">
                <p class="text-xs uppercase font-semibold text-gray-500">Words</p>
                <p id="wordCount" class="text-3xl font-bold text-blue-600 mt-1">0</p>
            </div>
            <!-- Unique Words Card -->
            <div class="stat-card">
                <p class="text-xs uppercase font-semibold text-gray-500">Unique Words</p>
                <p id="uniqueWordCount" class="text-3xl font-bold text-blue-600 mt-1">0</p>
            </div>
            <div class="stat-card">
                <p class="text-xs uppercase font-semibold text-gray-500">Characters (incl. spaces)</p>
                <p id="charCount" class="text-3xl font-bold text-gray-800 mt-1">0</p>
            </div>
            <div class="stat-card">
                <p class="text-xs uppercase font-semibold text-gray-500">Characters (no spaces)</p>
                <p id="charNoSpacesCount" class="text-3xl font-bold text-gray-800 mt-1">0</p>
            </div>
            <div class="stat-card">
                <p class="text-xs uppercase font-semibold text-gray-500">Lines</p>
                <p id="lineCount" class="text-3xl font-bold text-gray-800 mt-1">0</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Panel: Tools & Utilities -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl shadow-2xl h-fit">
                
                <!-- 1. Case Conversion Tools Panel -->
                <button id="toggle-case-tools" class="flex justify-between items-center w-full text-2xl font-semibold text-gray-800 mb-4 border-b pb-2 focus:outline-none hover:text-blue-600 transition duration-150">
                    Case Conversion Tools
                    <!-- Arrow icon starts pointing UP (rotate-180) for OPEN state -->
                    <svg id="case-icon" class="w-6 h-6 transform transition-transform duration-300 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="case-content" class="grid grid-cols-2 gap-4">
                    <button id="btn-sentence" class="btn-case btn-primary">Sentence Case</button>
                    <button id="btn-lower" class="btn-case btn-primary">lower case</button>
                    <button id="btn-upper" class="btn-case btn-primary">UPPER CASE</button>
                    <button id="btn-title" class="btn-case btn-primary">Title Case</button>
                    <button id="btn-cap" class="btn-case btn-primary">Capitalized Case</button>
                    <button id="btn-alternate" class="btn-case btn-primary">aLtErNaTiNg cAsE</button>
                    <button id="btn-toggle" class="btn-case btn-primary">tOGGLE cAsE</button>
                    <div></div> 
                </div>

                <!-- 2. Utility Actions Panel -->
                <div class="mt-8 border-t pt-4">
                    <button id="toggle-utility-tools" class="flex justify-between items-center w-full text-xl font-semibold text-gray-800 mb-4 focus:outline-none hover:text-blue-600 transition duration-150">
                        Utility Actions
                        <!-- Arrow icon starts pointing UP (rotate-180) for OPEN state -->
                        <svg id="utility-icon" class="w-5 h-5 transform transition-transform duration-300 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div id="utility-content" class="grid grid-cols-2 gap-4">
                        <button id="btn-copy" class="btn-case btn-secondary">
                            <svg class="inline-block w-4 h-4 mr-2 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v10a2 2 0 01-2 2h-2M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1"></path></svg>
                            Copy Text
                        </button>
                        <!-- Existing Clear button remains -->
                        <button id="btn-clear" class="btn-case btn-danger">
                            <svg class="inline-block w-4 h-4 mr-2 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-11v12h-4V4m-2 4h4"></path></svg>
                            Clear All
                        </button>
                        <button id="btn-reverse-words" class="btn-case btn-secondary">
                            <svg class="inline-block w-4 h-4 mr-2 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
                            Reverse Word Order
                        </button>
                        <button id="btn-normalize-spaces" class="btn-case btn-secondary">
                            <svg class="inline-block w-4 h-4 mr-2 -mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>
                            Remove Extra Spaces
                        </button>
                    </div>
                </div>
                
                <!-- 3. Goal Tracker Panel (NEW SECTION) -->
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Goal Tracker</h3>
                    <!-- Goal Type Selection -->
                    <div class="flex space-x-4 mb-3" id="goal-type-radios">
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="radio" name="goalType" value="words" checked id="radio-words" class="form-radio text-blue-600 h-4 w-4">
                            <span class="ml-2 text-gray-700 text-sm font-medium">Word Goal</span>
                        </label>
                        <label class="inline-flex items-center cursor-pointer">
                            <input type="radio" name="goalType" value="chars" id="radio-chars" class="form-radio text-blue-600 h-4 w-4">
                            <span class="ml-2 text-gray-700 text-sm font-medium">Character Goal</span>
                        </label>
                    </div>

                    <!-- Goal Target Input -->
                    <div class="mb-4">
                        <label for="goalTargetInput" class="block text-xs font-medium text-gray-500 mb-1">Target Count</label>
                        <input type="number" id="goalTargetInput" min="1" value="500" class="w-full p-2 border border-gray-300 rounded-lg text-lg focus:border-blue-500 transition duration-150">
                    </div>

                    <!-- Progress Display -->
                    <div id="goal-progress-container" class="space-y-2">
                        <div class="h-3 bg-gray-200 rounded-full overflow-hidden shadow-inner">
                            <div id="goal-progress-bar" class="h-full bg-blue-500 transition-all duration-500" style="width: 0%"></div>
                        </div>
                        <p id="goal-status-text" class="text-sm font-semibold text-gray-700 text-center">0 / 500 Words</p>
                    </div>
                </div>

                <!-- 4. Word Analysis Panel -->
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Word Frequency Analysis</h3>
                    <p class="text-sm text-gray-500 mb-3">Top 10 most used words (excluding common "stop" words).</p>
                    <div id="word-analysis-results" class="word-list-container bg-gray-50 p-4 rounded-lg border border-gray-200 shadow-inner">
                        <p class="text-gray-400 italic" id="analysis-placeholder">Start typing to see results...</p>
                    </div>
                </div>

                <!-- 5. AdSense Code for Monetization -->
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <p class="text-sm font-semibold text-gray-500 mb-2 uppercase tracking-wider">Monetization</p>
                    
                    <!-- START OF AD NETWORK CODE -->
                    <div class="mx-auto my-4 text-center p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <p class="text-sm font-bold text-yellow-800 mb-3">⚠️ ACTION REQUIRED: REPLACE PLACEHOLDERS</p>
                        <!-- 
                            *** IMPORTANT: REPLACE THESE VALUES with your actual AdSense data ***
                            1. data-ad-client: Your Publisher ID (e.g., 'ca-pub-1234567890123456') 
                            2. data-ad-slot: Your Ad Unit Slot ID (e.g., '1234567890')
                        -->
                        <ins class="adsbygoogle"
                             style="display:block; width: 100%; height: 300px;" 
                             data-ad-client="ca-pub-1234567890123456" 
                             data-ad-slot="1234567890"
                             data-ad-format="auto"
                             data-full-width-responsive="true"></ins>
                        
                        <!-- FIX: Added the ad push script here, immediately after the ins tag, which is the correct AdSense implementation to ensure 'adsbygoogle' is ready when called. -->
                        <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                    </div>
                    <!-- END OF AD NETWORK CODE -->

                </div>

            </div>

            <!-- Text Input/Output Area (Right/Bottom) -->
            <div class="lg:col-span-2">
                <label for="textInput" class="block text-xl font-semibold text-gray-800 mb-3">Paste or Type Text Here:</label>
                <!-- Wrapper for the inline clear button -->
                <div class="relative"> 
                    <textarea id="textInput" rows="18" class="w-full p-6 text-xl border-4 border-blue-200 rounded-xl shadow-inner focus:border-blue-500 focus:ring-0 resize-none transition duration-150" placeholder="Start typing or paste your text to see the magic happen!"></textarea>
                    
                    <!-- New Inline Clear Button -->
                    <button id="btn-clear-inline" class="absolute top-2 right-2 p-2 rounded-full bg-white text-gray-400 hover:text-red-500 hover:bg-gray-100 transition duration-150 shadow-md hidden" title="Clear All Text">
                        <!-- X Icon -->
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- Feedback Message -->
                <div id="feedback-message" class="mt-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-xl hidden" role="alert">
                    <p id="feedback-text" class="font-semibold"></p>
                </div>
            </div>
        </div>

        <!-- FOOTER SECTION -->
        <footer class="mt-16 pt-8 border-t border-gray-200">
            <div class="flex flex-col md:flex-row justify-center items-center space-y-2 md:space-y-0 md:space-x-6 text-sm text-gray-600 mb-4 font-medium">
                <button id="btn-open-privacy" class="hover:text-blue-600 transition duration-150 focus:outline-none">Privacy Policy (CRITICAL)</button>
                <a href="#terms-of-service" class="hover:text-blue-600 transition duration-150">Terms of Service</a>
                <a href="#contact-us" class="hover:text-blue-600 transition duration-150">Contact / About Us</a>
            </div>
            <p class="text-center text-gray-500 text-sm">&copy; <span id="currentYear"></span> Text Transformer. Built for high utility and fast performance.</p>
        </footer>
        <!-- END FOOTER -->
    </div>

    <!-- PRIVACY POLICY MODAL (NEW BLOCK) -->
    <!-- This modal is hidden by default and triggered by the footer link -->
    <div id="privacy-modal" class="fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-75 hidden transition-opacity duration-300">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto p-8 relative">
                
                <h1 class="text-3xl font-bold text-gray-800 mb-4 border-b pb-2">Privacy Policy for Text Transformer & Analyzer</h1>
                <p class="text-sm text-gray-500 mb-6">**Last Updated: October 20, 2024**</p>

                <div class="space-y-6 text-gray-700 text-md leading-relaxed">
                    
                    <p>The Text Transformer & Analyzer (the "Service") is committed to protecting the privacy of its users. This policy outlines how we handle information when you use our website.</p>

                    <h2 class="text-2xl font-semibold mt-6 mb-2">1. Information We DO NOT Collect</h2>
                    <p>We do not require users to register, log in, or provide any personal identifiable information (PII) to use the core functionality of the Service.</p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>**No User Accounts:** We do not collect names, email addresses, physical addresses, or any other personal data that can directly identify you.</li>
                        <li>**No Text Storage:** The text you paste or type into the analysis box is processed instantly within your web browser. This text **is not** stored on our servers, nor is it transmitted to us for analysis or storage. Once you close the browser tab, the text is gone from our Service.</li>
                    </ul>

                    <h2 class="text-2xl font-semibold mt-6 mb-2">2. Information We Automatically Collect (Non-Personal Data)</h2>
                    <p>Like most websites, we utilize standard third-party tools that collect non-personal data to help us understand how the site is used, diagnose problems, and serve advertisements.</p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>**Usage Data:** We collect general, anonymous data about your visit, such as the pages you view, the type of browser you use, and the duration of your visit, solely for traffic analysis and site improvement.</li>
                        <li>**Cookies:** We use cookies to manage and maintain the functionality of the website (e.g., remembering a setting). Third-party providers, such as those listed below, also use cookies for advertising and analytics purposes.</li>
                    </ul>

                    <h2 class="text-2xl font-semibold mt-6 mb-2">3. Third-Party Services (Advertising and Analytics)</h2>
                    <p>The Service relies on third parties for essential functions. By using this website, you acknowledge and agree to the privacy practices of the following providers:</p>

                    <h3 class="text-xl font-semibold mt-4">Google AdSense</h3>
                    <p>This Service uses **Google AdSense** to display advertisements. AdSense uses the **DoubleClick DART cookie** to serve ads based on a user's prior visits to this website and other websites on the internet.</p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li>Google’s use of advertising cookies enables it and its partners to serve ads to our users based on their visit to our sites and/or other sites on the Internet.</li>
                        <li>You may opt out of the use of the DART cookie by visiting the <a href="https://policies.google.com/technologies/ads" target="_blank" class="text-blue-600 hover:underline font-medium">Google Ad and Content Network Privacy Policy</a>.</li>
                    </ul>

                    <h3 class="text-xl font-semibold mt-4">Google Analytics</h3>
                    <p>We use **Google Analytics** to track and analyze website traffic. Google Analytics uses cookies to collect information on your use of the site, which is aggregated to provide reports on website activity.</p>

                    <h2 class="text-2xl font-semibold mt-6 mb-2">4. Links to Other Sites</h2>
                    <p>Our website may contain links to other sites that are not operated by us. If you click on a third-party link, you will be directed to that third party's site. We strongly advise you to review the Privacy Policy of every site you visit.</p>

                    <h2 class="text-2xl font-semibold mt-6 mb-2">5. Contact Us</h2>
                    <p>If you have any questions about this Privacy Policy or the practices of this site, please contact us at:</p>
                    <p class="text-lg font-mono p-3 bg-blue-50 border border-blue-200 rounded-lg inline-block mt-2">
                        support@yourwebsitename.com **(ACTION: Replace this with your actual email)**
                    </p>
                </div>
                
                <!-- Close Button for Modal -->
                <button id="btn-close-privacy" class="absolute top-4 right-4 p-2 rounded-full bg-gray-200 hover:bg-gray-300 transition duration-150">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>

            </div>
        </div>
    </div>
    <!-- END PRIVACY POLICY MODAL -->


    <script>
        const inputArea = document.getElementById('textInput');
        const btnClearPanel = document.getElementById('btn-clear');
        const btnClearInline = document.getElementById('btn-clear-inline'); 
        
        // Goal Tracker Elements
        const goalTargetInput = document.getElementById('goalTargetInput');
        const goalTypeRadios = document.querySelectorAll('input[name="goalType"]');
        const goalProgressBar = document.getElementById('goal-progress-bar');
        const goalStatusText = document.getElementById('goal-status-text');

        const counts = {
            words: document.getElementById('wordCount'),
            uniqueWords: document.getElementById('uniqueWordCount'), 
            chars: document.getElementById('charCount'),
            charsNoSpaces: document.getElementById('charNoSpacesCount'),
            lines: document.getElementById('lineCount')
        };
        const feedback = document.getElementById('feedback-message');
        const feedbackText = document.getElementById('feedback-text');
        const analysisResults = document.getElementById('word-analysis-results');
        const analysisPlaceholder = document.getElementById('analysis-placeholder');

        // Modal Elements
        const privacyModal = document.getElementById('privacy-modal');
        const btnOpenPrivacy = document.getElementById('btn-open-privacy');
        const btnClosePrivacy = document.getElementById('btn-close-privacy');


        // Common English Stop Words (can be expanded)
        const STOP_WORDS = new Set([
            'a', 'an', 'and', 'the', 'is', 'am', 'are', 'was', 'were', 'be', 'of', 'to', 'in', 'on', 'at', 
            'by', 'for', 'with', 'from', 'as', 'it', 'its', 'he', 'she', 'they', 'we', 'you', 'your', 'my', 
            'i', 'me', 'us', 'him', 'her', 'them', 'this', 'that', 'these', 'those', 'but', 'or', 'not', 
            'no', 'so', 'up', 'out', 'down', 'about', 'just', 'can', 'will', 'would', 'should', 'have', 
            'has', 'had', 'do', 'does', 'did', 'if', 'when', 'where', 'why', 'how', 'which', 'who', 'whom', 
            'then', 'than', 'only', 'such', 'all', 'any', 'most', 'some', 'one', 'two', 'three', 'four', 
            'five', 'six', 'seven', 'eight', 'nine', 'ten', 'more', 'less', 'very', 'too', 'also', 'much', 
            'many', 'etc', 'etc.' 
        ]);

        // --- Core Text Utility Functions ---

        function updateGoalTracker(currentWords, currentCharCount) {
            const goalType = document.querySelector('input[name="goalType"]:checked').value;
            let target = parseInt(goalTargetInput.value) || 0;
            
            // Ensure target is positive and sensible
            if (target <= 0) {
                target = 1;
                goalTargetInput.value = 1;
            }

            const currentCount = (goalType === 'words') ? currentWords : currentCharCount;
            const unit = (goalType === 'words') ? 'Words' : 'Characters';
            
            const percentage = Math.min((currentCount / target) * 100, 100);
            
            goalProgressBar.style.width = `${percentage}%`;
            goalStatusText.textContent = `${currentCount} / ${target} ${unit}`;

            // Update bar color based on progress
            if (percentage >= 100) {
                goalProgressBar.classList.remove('bg-blue-500', 'bg-yellow-500');
                goalProgressBar.classList.add('bg-green-500');
                goalStatusText.classList.remove('text-gray-700');
                goalStatusText.classList.add('text-green-600', 'font-extrabold');
                if (currentCount > target) {
                    goalStatusText.textContent = `Goal Exceeded! (+${currentCount - target} ${unit})`;
                } else {
                    goalStatusText.textContent = `GOAL REACHED! (${currentCount} ${unit})`;
                }
            } else if (percentage >= 75) {
                goalProgressBar.classList.remove('bg-blue-500', 'bg-green-500');
                goalProgressBar.classList.add('bg-yellow-500');
                goalStatusText.classList.remove('text-green-600', 'font-extrabold');
                goalStatusText.classList.add('text-gray-700');
            } else {
                goalProgressBar.classList.remove('bg-yellow-500', 'bg-green-500');
                goalProgressBar.classList.add('bg-blue-500');
                goalStatusText.classList.remove('text-green-600', 'font-extrabold');
                goalStatusText.classList.add('text-gray-700');
            }
        }


        function updateStats(text) {
            // Characters (with spaces)
            counts.chars.textContent = text.length;
            const currentCharCount = text.length; // Capture for goal tracker

            // Characters (without spaces)
            counts.charsNoSpaces.textContent = text.replace(/\s/g, '').length;

            // Prepare text for word counting (remove punctuation, normalize case)
            const normalizedText = text.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"");
            const wordsArray = normalizedText.trim().split(/\s+/).filter(word => word.length > 0);
            
            // Total Words
            counts.words.textContent = wordsArray.length;
            const currentWords = wordsArray.length; // Capture for goal tracker
            
            // Unique Words (using a Set)
            const uniqueWordsSet = new Set(wordsArray);
            counts.uniqueWords.textContent = uniqueWordsSet.size;

            // Lines
            counts.lines.textContent = text.trim().length === 0 ? 0 : text.split('\n').length;
            
            // Update Word Frequency
            updateWordFrequency(text);
            
            // Update Goal Tracker
            updateGoalTracker(currentWords, currentCharCount);

            // Toggle visibility of the inline clear button
            if (text.length > 0) {
                btnClearInline.classList.remove('hidden');
            } else {
                btnClearInline.classList.add('hidden');
            }
        }

        function calculateWordFrequency(text) {
            const wordFrequencies = new Map();
            
            // Clean and split text into words (same normalization as unique count)
            const words = text.toLowerCase()
                .replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"")
                .split(/\s+/)
                .filter(word => word.length > 0 && !STOP_WORDS.has(word));

            words.forEach(word => {
                wordFrequencies.set(word, (wordFrequencies.get(word) || 0) + 1);
            });

            // Convert map to array and sort by frequency (descending)
            const sortedWords = Array.from(wordFrequencies.entries()).sort((a, b) => b[1] - a[1]);

            return sortedWords.slice(0, 10); // Return top 10
        }

        function updateWordFrequency(text) {
            if (text.trim().length === 0) {
                analysisResults.innerHTML = '<p class="text-gray-400 italic" id="analysis-placeholder">Start typing to see results...</p>';
                return;
            }

            const topWords = calculateWordFrequency(text);
            
            if (topWords.length === 0) {
                analysisResults.innerHTML = '<p class="text-gray-400 italic">No non-stop words found.</p>';
                return;
            }

            let html = '<table class="w-full text-sm text-left">';
            topWords.forEach(([word, count], index) => {
                const color = index === 0 ? 'text-blue-600 font-bold' : 'text-gray-700';
                html += `
                    <tr class="border-b last:border-b-0 hover:bg-white transition duration-100">
                        <td class="py-1 px-1 w-10 text-center text-gray-500">${index + 1}.</td>
                        <td class="py-1 px-1 ${color} w-3/5">${word}</td>
                        <td class="py-1 px-1 text-right font-mono text-xs text-blue-500">${count}</td>
                    </tr>
                `;
            });
            html += '</table>';
            analysisResults.innerHTML = html;
        }


        function toSentenceCase(text) {
            text = text.toLowerCase();
            // This is a basic implementation. It capitalizes the very first letter and the letter after a punctuation mark (. ! ?).
            return text.replace(/(^\s*\w|[.!?]\s*\w)/g, (char) => char.toUpperCase());
        }

        function toTitleCase(text) {
            // Title Case (with exceptions for minor words)
            const minorWords = [
                'a', 'an', 'the', 'and', 'but', 'or', 'for', 'nor', 'on', 'at', 'to', 'by', 'in', 'of', 'up', 'as'
            ];
            
            return text.toLowerCase().split(/\s+/).map((word, index) => {
                // Always capitalize the first word, regardless of whether it's minor.
                if (index === 0 || !minorWords.includes(word)) {
                    return word.charAt(0).toUpperCase() + word.slice(1);
                }
                return word;
            }).join(' ');
        }
        
        function toCapitalizedCase(text) {
            // Capitalized Case (Simple: capitalize the first letter of EVERY word)
            return text.toLowerCase().split(/\s+/).map(word => {
                if (word.length === 0) return '';
                return word.charAt(0).toUpperCase() + word.slice(1);
            }).join(' ');
        }

        function toAlternateCase(text) {
            return text.split('').map((char, index) => {
                if (/\s/.test(char)) return char; // Skip spaces
                if (index % 2 === 0) {
                    return char.toLowerCase();
                } else {
                    return char.toUpperCase();
                }
            }).join('');
        }

        function toToggleCase(text) {
            return text.split('').map(char => {
                if (char === char.toUpperCase()) {
                    return char.toLowerCase();
                } else {
                    return char.toUpperCase();
                }
            }).join('');
        }
        
        function toReverseWordOrder(text) {
            // Splits the text by whitespace, reverses the array of words, and joins them back.
            return text.trim().split(/\s+/).reverse().join(' ');
        }

        function toNormalizeSpacing(text) {
            // Removes leading/trailing whitespace and replaces multiple spaces (including newlines and tabs) with a single space.
            return text.trim().replace(/\s+/g, ' ');
        }

        
        // --- Accordion Toggle Handler ---
        function togglePanel(contentId, iconId) {
            const content = document.getElementById(contentId);
            const icon = document.getElementById(iconId);

            const isHidden = content.classList.contains('hidden');
            if (isHidden) {
                // Open panel
                content.classList.remove('hidden');
                icon.classList.remove('rotate-0');
                icon.classList.add('rotate-180'); // Rotate arrow up
            } else {
                // Close panel
                content.classList.add('hidden');
                icon.classList.remove('rotate-180');
                icon.classList.add('rotate-0'); // Rotate arrow down
            }
        }
        
        // Function to handle clearing the input area
        function handleClearInput() {
            if (inputArea.value.trim() !== '') {
                inputArea.value = '';
                updateStats('');
                showFeedback('Text area cleared.', 'success', 2000);
            }
        }


        // --- Event Handlers ---
        
        function handleConversion(conversionFunction) {
            const currentText = inputArea.value;
            if (currentText.trim() === '') return;
            
            inputArea.value = conversionFunction(currentText);
            // Stats and analysis are updated automatically via the 'input' listener
        }

        function showFeedback(message, type = 'success', duration = 3000) {
            feedback.className = `mt-4 px-4 py-3 rounded-xl transition duration-150 ${type === 'success' ? 'bg-green-100 border border-green-400 text-green-700' : 'bg-red-100 border border-red-400 text-red-700'}`;
            feedbackText.textContent = message;
            feedback.classList.remove('hidden');

            setTimeout(() => {
                feedback.classList.add('hidden');
            }, duration);
        }

        // --- Event Listeners and Initial Setup ---

        // Real-time stat update on every input
        inputArea.addEventListener('input', () => {
            updateStats(inputArea.value);
        });

        // Goal Tracker listeners (Trigger stats update on change)
        goalTargetInput.addEventListener('input', () => updateStats(inputArea.value));
        goalTypeRadios.forEach(radio => {
            radio.addEventListener('change', () => updateStats(inputArea.value));
        });

        // Conversion button listeners
        document.getElementById('btn-sentence').addEventListener('click', () => handleConversion(toSentenceCase));
        document.getElementById('btn-lower').addEventListener('click', () => handleConversion(t => t.toLowerCase()));
        document.getElementById('btn-upper').addEventListener('click', () => handleConversion(t => t.toUpperCase()));
        document.getElementById('btn-title').addEventListener('click', () => handleConversion(toTitleCase));
        document.getElementById('btn-cap').addEventListener('click', () => handleConversion(toCapitalizedCase));
        document.getElementById('btn-alternate').addEventListener('click', () => handleConversion(toAlternateCase));
        document.getElementById('btn-toggle').addEventListener('click', () => handleConversion(toToggleCase));
        
        // Utility Action listeners
        document.getElementById('btn-reverse-words').addEventListener('click', () => handleConversion(toReverseWordOrder));
        document.getElementById('btn-normalize-spaces').addEventListener('click', () => handleConversion(toNormalizeSpacing));

        // Accordion listeners
        document.getElementById('toggle-case-tools').addEventListener('click', () => togglePanel('case-content', 'case-icon'));
        document.getElementById('toggle-utility-tools').addEventListener('click', () => togglePanel('utility-content', 'utility-icon'));


        // Copy to Clipboard function
        document.getElementById('btn-copy').addEventListener('click', () => {
            if (inputArea.value.trim() === '') {
                showFeedback('Nothing to copy. Please enter some text first.', 'error');
                return;
            }
            // Use document.execCommand('copy') for better compatibility in iframe environments
            inputArea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showFeedback('Copied to clipboard successfully!');
                } else {
                    showFeedback('Failed to copy. Please copy manually.', 'error');
                }
            } catch (err) {
                showFeedback('Copying is not supported on this browser.', 'error');
            }
            window.getSelection().removeAllRanges(); // Deselect the text
        });

        // Clear Text functions (both panel button and inline button use the same logic)
        btnClearPanel.addEventListener('click', handleClearInput);
        btnClearInline.addEventListener('click', handleClearInput);

        // Modal Handlers
        btnOpenPrivacy.addEventListener('click', (e) => {
            e.preventDefault(); // Stop the default anchor jump
            privacyModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        });

        btnClosePrivacy.addEventListener('click', () => {
            privacyModal.classList.add('hidden');
            document.body.style.overflow = ''; // Restore scrolling
        });
        
        // Close modal on outside click
        privacyModal.addEventListener('click', (e) => {
            if (e.target === privacyModal) {
                privacyModal.classList.add('hidden');
                document.body.style.overflow = '';
            }
        });


        // Initial call to set stats to zero and year in footer
        document.addEventListener('DOMContentLoaded', () => {
            updateStats(inputArea.value);
            document.getElementById('currentYear').textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>
